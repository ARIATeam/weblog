---
layout: post
title: Potential Circumvention of CSRF Protection in Rails 2.1
categories: []
author: michael
published: true
date: 2008-11-18 18:13:00.000000000 +00:00
---
There is a bug in all 2.1.x versions of Ruby on Rails which affects the effectiveness of the CSRF protection given by protect_from_forgery.

By design rails does not perform token verification on requests with certain content types not typically generated by browsers.  Unfortunately this list also included 'text/plain' which can be generated by browsers.

h2. Impact

Requests can be crafted which will circumvent the CSRF protection entirely.  Rails does not parse the parameters provided with these requests, but that may not be enough to protect your application.

h2. Affected Versions

* All releases in the 2.1 series
* All 2.2 Pre Releases

h2. Fixes

The upcoming 2.1.3 and 2.2.2 releases will contain a fix for this issue.

h2. Interim Workarounds

Users of 2.1.x releases are advised to insert the following code into a file in config/initializers/

>  Mime::Type.unverifiable_types.delete(:text)


Users of Edge Rails after 2.2.1, should upgrade to the latest code in 2-2-stable.

The patch for the 2.1.x series is available on "github":http://github.com/rails/rails/commit/099a98e9b7108dae3e0f78b207e0a7dc5913bd1a. This will also apply cleanly to 2.2 pre-releases prior to "this changeset":http://github.com/rails/rails/commit/f1ad8b48aae3ee26613b3e77bc0056e120096846 released on Thursday November 13th at 11:19:53 2008 CET.  Users with edge-rails checkouts after that date, are advised to upgrade to the latest code in 2-2-stable.

Thanks to "Steve from Coderrr":http://coderrr.wordpress.com/ for reporting this issue.